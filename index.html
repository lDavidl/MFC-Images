<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dragon Emperor Images</title>

<!-- FAVICON -->
<link rel="icon" type="image/png" href="/favicon.png">

<style>
/* ===== BASE ===== */
body {
  font-family: sans-serif;
  background: #d0d0d0;
  padding: 20px;
  margin: 0;
  transition: background 0.3s, color 0.3s;
}

h1 {
  text-align: center;
  margin-bottom: 20px;
}

/* ===== CONTROLS ===== */
.controls {
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

button, input {
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid #aaa;
  font-size: 0.9em;
}

/* ===== GALLERY ===== */
.gallery {
  background: #bfbfbf;
  padding: 20px;
  border-radius: 12px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 20px;
  justify-items: center;
}

.item {
  text-align: center;
  cursor: pointer;
  transition: transform 0.2s;
}

.item:hover { transform: scale(1.05); }

img {
  width: 100%;
  height: auto;
  max-width: 200px;
  border-radius: 6px;
  border: 1px solid #888;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

.filename {
  font-size: 0.85em;
  margin-top: 6px;
  cursor: pointer;
  word-break: break-word;
}

.filename:hover { text-decoration: underline; }

/* ===== MODAL ===== */
.modal {
  display: none;
  position: fixed;
  z-index: 999;
  inset: 0;
  background: rgba(0,0,0,0.9);
}

.modal-content {
  margin: auto;
  display: block;
  max-width: 90vw;
  max-height: 90vh;
  width: auto;
  height: auto;
  object-fit: contain;
}

.close {
  position: absolute;
  top: 20px;
  right: 30px;
  font-size: 40px;
  color: #fff;
  cursor: pointer;
}

/* ===== DARK MODE ===== */
body.dark {
  background: #121212;
  color: #eee;
}

body.dark .gallery { background: #1e1e1e; }
body.dark img { border-color: #333; }
body.dark .filename { color: #ddd; }
body.dark button, body.dark input {
  background: #222;
  color: #eee;
  border-color: #444;
}
</style>
</head>

<body>

<h1>...</h1>

<div class="controls">
  <button data-folder="">All</button>
  <button data-folder="gifs">GIFs</button>
  <button data-folder="images">Images</button>
  <input type="text" id="search" placeholder="Searchâ€¦">
  <button id="toggle">Dark mode</button>
</div>

<div id="gallery" class="gallery"></div>

<!-- MODAL -->
<div id="modal" class="modal">
  <span class="close">&times;</span>
  <img id="modal-img" class="modal-content">
</div>

<script>
/* ===== CONFIG ===== */
const owner = "lDavidl";
const repo = "MFC-Images";
const baseURL = "https://img.dragonemperor.xyz/";
const perPage = 30;

/* ===== STATE ===== */
let allFiles = [];
let filtered = [];
let page = 0;

/* ===== ELEMENTS ===== */
const gallery = document.getElementById("gallery");
const modal = document.getElementById("modal");
const modalImg = document.getElementById("modal-img");
const search = document.getElementById("search");
const toggle = document.getElementById("toggle");

/* ===== DARK MODE ===== */
if (localStorage.getItem("dark") === "1") {
  document.body.classList.add("dark");
  toggle.textContent = "Light mode";
}

toggle.onclick = () => {
  document.body.classList.toggle("dark");
  const on = document.body.classList.contains("dark");
  toggle.textContent = on ? "Light mode" : "Dark mode";
  localStorage.setItem("dark", on ? "1" : "0");
};

/* ===== FETCH ===== */
function loadFolder(folder="") {
  page = 0;
  gallery.innerHTML = "";
  fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${folder}`)
    .then(r => r.json())
    .then(files => {
      const gifs = files.filter(f => /\.gif$/i.test(f.name)).sort((a,b)=>a.name.localeCompare(b.name));
      const imgs = files.filter(f => /\.(png|jpg|jpeg|webp)$/i.test(f.name)).sort((a,b)=>a.name.localeCompare(b.name));
      allFiles = [...gifs, ...imgs];
      applyFilter();
    });
}

/* ===== FILTER ===== */
function applyFilter() {
  const q = search.value.toLowerCase();
  filtered = allFiles.filter(f => f.name.toLowerCase().includes(q));
  gallery.innerHTML = "";
  page = 0;
  loadMore();
}

search.oninput = applyFilter;

/* ===== INFINITE SCROLL ===== */
function loadMore() {
  const slice = filtered.slice(page * perPage, (page + 1) * perPage);
  slice.forEach(file => {
    const div = document.createElement("div");
    div.className = "item";

    const img = document.createElement("img");
    img.loading = "lazy";
    img.src = file.download_url;

    const name = document.createElement("div");
    name.className = "filename";
    name.textContent = file.name;
    name.onclick = e => {
      e.stopPropagation();
      navigator.clipboard.writeText(baseURL + file.name);
      name.textContent = "Copied!";
      setTimeout(()=>name.textContent=file.name,800);
    };

    div.onclick = () => {
      modal.style.display = "flex";
      modalImg.src = file.download_url;
    };

    div.append(img, name);
    gallery.appendChild(div);
  });
  page++;
}

window.addEventListener("scroll", () => {
  if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 300) {
    loadMore();
  }
});

/* ===== MODAL CLOSE ===== */
document.querySelector(".close").onclick = () => modal.style.display="none";
modal.onclick = e => { if (e.target === modal) modal.style.display="none"; };

/* ===== NAV BUTTONS ===== */
document.querySelectorAll("[data-folder]").forEach(btn => {
  btn.onclick = () => loadFolder(btn.dataset.folder);
});

/* ===== INIT ===== */
loadFolder();
</script>
</body>
</html>
